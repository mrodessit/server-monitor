
<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">

<link rel="import" href="shared-styles.html">

<script type="text/javascript" language="javascript" src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<script type="text/javascript" language="javascript" src="https://cdn.datatables.net/1.10.13/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" language="javascript" src="https://cdn.datatables.net/1.10.13/js/dataTables.material.min.js"></script>

<dom-module id="sm-user-list">
  <template>
    <style include="shared-styles">
    
      :host {
        display: block;

        padding: 10px;
      }

      table thead td {
        font-weight: 700;
      }

    </style>

    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/material-design-lite/1.1.0/material.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.13/css/dataTables.material.min.css">

    <h1> User List </h1>

    <div class="card">
        <iron-ajax id="ajaxGetUserList" url="/api/user/get/list" on-response="handleResponse"></iron-ajax>
        <table id="tableUser" class="mdl-data-table" width="100%" cellspacing="0">
           <thead>
               <td>id</td>
               <td>username</td>
               <td>is Admin</td>
               <td>actions</td>
           </thead>
        </table>
    </div>    

  </template>

  <script>            
    var dataTable;

    Polymer({
        is: 'sm-user-list',  

        properties: {
            active: {
                type: Boolean,
                value: false,
                observer: '_activeChanged',
            },
        },

        ready: function() {
          dataTable = $('#tableUser').DataTable( {} );
        },

        _activeChanged: function(newValue, oldValue) {            
            if(newValue) {
              ajaxGetUserList.generateRequest();
            }            
        },

/*
        ready : function() {
          console.log(this.localName + ' ready');
        },
        created: function() {
          console.log(this.localName + ' was created');
        },
        attached: function() {
          console.log(this.localName + ' was attached');
          //this._activateToolBarButtons();
        },
        detached: function() {
          console.log(this.localName + ' was detached');
          //this._deactivateToolBarButtons();
        },              

        attributeChanged: function(name, type) {
            console.log(this.localName + ' attribute ' + name + ' was changed to ' + this.getAttribute(name));
        },
*/        

        handleResponse: function(data) {

          var tableData = [];
          var serverData = data.detail.response.data; 

          for (var i=0; i<serverData.length; i++) {
            var row = [
              serverData[i].id,
              serverData[i].username,
              (serverData[i].isadmin) ? "true" : "false",
              '<a href="/user-delete?id='+serverData[i].id+'" tabindex="-1">'+
                '<paper-button raised>Delete</paper-button>'+
              '</a>',
            ];

            tableData.push(row);
          }

          dataTable.clear();
          dataTable.rows.add(tableData).draw();
        }
    });

  </script>
</dom-module>
